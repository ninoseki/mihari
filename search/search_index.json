{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Mihari","text":"<p>A query aggregator for OSINT based threat hunting.</p> <p>Mihari can aggregate multiple searches across multiple services in a single rule &amp; persist findings in a database.</p> <ul> <li>Requirements</li> <li>Installation</li> <li>Architecture</li> <li>Rule</li> <li>Configuration</li> <li>Usage</li> </ul> <p>You can also refer to JSAC2024 workshop materials to learn how Mihari works through some exercises.</p>"},{"location":"architecture/","title":"Architecture","text":"<p>Mihari uses following components:</p> <ul> <li>rails/thor for building the CLI application.</li> <li>ruby-grape/grape, rack/rack and puma/puma for building and running the web application.</li> <li>sidekiq/sidekiq for (optional) background processing.</li> <li>vuejs for building the frontend SPA.</li> </ul>"},{"location":"architecture/#basic","title":"Basic","text":"<pre><code>flowchart LR\n    CLI[\"CLI\\n(Thor)\"] --&gt; Database\n    Web[\"Web\\n(Grape on Rack + Puma)\"] --&gt; Database</code></pre>"},{"location":"architecture/#advanced","title":"Advanced","text":"<pre><code>flowchart LR\n    CLI[\"CLI\\n(Thor)\"] --&gt; Database\n    Web[\"Web\\n(Grape on Rack + Puma)\"] --&gt; Database\n    Web --&gt; Sidekiq[\"Job Queue\\n(Sidekiq)\"]\n    Sidekiq --&gt; Database\n    Sidekiq --&gt; Redis</code></pre> <p>This one is recommended if you want to use the API a lot.</p> <p>Sidekiq handles time-consuming jobs such as searching a rule, etc.</p> <p>Note</p> <p>The web application runs on Rack + Puma. Its default HTTP request timeout is 60s. It means that a search exceeds 60s will fail.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>Configuration can be done via environment variables.</p> <p>Alternatively you can set values through <code>.env</code> file. Values in <code>.env</code> file will be automatically loaded.</p>"},{"location":"configuration/#analyzers","title":"Analyzers","text":"Environment Variable Type Description Default BINARYEDGE_API_KEY String BinaryEdge API key CENSYS_VERSION String Censys API version (2 or 3) <code>2</code> CENSYS_ID String Censys API ID (v2) CENSYS_SECRET String Censys secret (v2) CENSYS_PAT String Censys PAT (v3) CENSYS_ORGANIZATION_ID String Censys Organization ID (v3) CIRCL_PASSIVE_PASSWORD String CIRCL passive DNS/SSL password CIRCL_PASSIVE_USERNAME String CIRCL passive DNS/SSL username ONYPHE_API_KEY String Onyphe API key OTX_API_KEY String OTX API key PASSIVETOTAL_API_KEY String PassiveTotal API key PASSIVETOTAL_USERNAME String PassiveTotal username PULSEDIVE_API_KEY String Pulsedive API key SECURITYTRAILS_API_KEY String SecurityTrails API key SHODAN_API_KEY String Shodan API key URLSCAN_API_KEY String urlscan.io API key VALIDIN_API_KEY String Validin API key VIRUSTOTAL_API_KEY String VirusTotal API key ZOOMEYE_API_KEY String ZoomEye API key"},{"location":"configuration/#emitters","title":"Emitters","text":"Environment Variable Type Description Default DATABASE_URL String Database URL <code>sqlite3:mihari.db</code> MISP_API_KEY String MISP API key MISP_URL String MISP URL SLACK_CHANNEL String Slack channel name <code>#general</code> SLACK_WEBHOOK_URL String Slack Webhook URL THEHIVE_API_KEY String TheHive API key, THEHIVE_URL String TheHive URL <p>Tip</p> <p>A typical form of a database URL is <code>dialect+driver://username:password@host:port/database</code>. See Database for details.</p>"},{"location":"configuration/#general-analyzersenrichersemitters-options","title":"General Analyzers/Enrichers/Emitters Options","text":"Environment Variable Type Description Default ANALYZER_PARALLELISM Boolean Whether to run analyzers in parallel <code>false</code> EMITTER_PARALLELISM Boolean Whether to run emitters in parallel <code>true</code> IGNORE_ERROR Boolean Whether to ignore error while querying <code>false</code> PAGINATION_INTERVAL Integer Pagination interval <code>0</code> PAGINATION_LIMIT Integer Pagination limit <code>100</code> RETRY_EXPONENTIAL_BACKOFF Boolean Whether to use retry exponential back off <code>true</code> RETRY_INTERVAL Integer Retry interval <code>5</code> RETRY_TIMES Integer Retry times <code>3</code>"},{"location":"configuration/#sidekiq","title":"Sidekiq","text":"Environment Variable Type Description Default SIDEKIQ_REDIS_URL String Redis URL for Sidekiq SIDEKIQ_RETRY Integer Retry times for a failed job <code>0</code> <p>Tip</p> <p>A typical form of a Redis URL is <code>redis://username:password@host:port</code>. (e.g. <code>redis://localhost:6379</code>)</p>"},{"location":"configuration/#others","title":"Others","text":"Environment Variable Type Description Default HIDE_CONFIG_VALUES Boolean Whether to hide config values from output <code>true</code> SENTRY_DSN String Sentry DSN SENTRY_TRACE_SAMPLE_RATE Float Sentry trace sample rate <code>0.25</code>"},{"location":"dev/","title":"Development","text":""},{"location":"dev/#requirements","title":"Requirements","text":"<ul> <li>Ruby v3.2+</li> <li>Node.js v22+</li> <li>Python</li> <li>Docker (Docker Compose)</li> <li>actionlint</li> </ul>"},{"location":"dev/#main-directories","title":"Main Directories","text":"<pre><code>.\n\u251c\u2500\u2500 docs      # MKDocs based docs\n\u251c\u2500\u2500 frontend  # Vue.js based frontend\n\u251c\u2500\u2500 lib       # Mihari gem\n\u2514\u2500\u2500 spec      # Rspec tests\n</code></pre>"},{"location":"dev/#project-setup","title":"Project Setup","text":"<pre><code># Install Ruby dependencies\nbundle install\n# Install Lefthook hook\nlefthook install\n# Install Python dependencies for documentation (optional)\npip install -r requirements.txt\n# Install Node.js dependencies (optional)\ncd frontend\nnpm install\n</code></pre>"},{"location":"dev/#tips","title":"Tips","text":""},{"location":"dev/#how-to-run-tests","title":"How to Run Tests","text":"<pre><code>bundle exec rake\n</code></pre> <pre><code>cd frontend\nnpm run test:unit\n</code></pre>"},{"location":"dev/#how-o-build-the-frontend","title":"How o Build the Frontend","text":"<p>The repository does not contain the built frontend assets. So you have to build the frontend to dev/test the web app.</p> <pre><code>cd frontend\nnpm run build\n</code></pre> <p>Alternatively, you can do it by:</p> <pre><code>./build_frontend.sh\n</code></pre>"},{"location":"dev/#how-to-build-the-docs","title":"How to Build the Docs","text":"<pre><code>mkdocs build\n# or\nmkdocs serve\n</code></pre>"},{"location":"diagrams/","title":"Diagrams","text":""},{"location":"diagrams/#active-record-class-diagram","title":"Active Record Class Diagram","text":"<pre><code>classDiagram\n  class Rule {\n    string id\n    string title\n    string description\n    json data\n    datetime created_at\n    datetime updated_at\n  }\n  Rule *-- Alert\n  Rule *-- Tagging\n  Rule *-- Tag\n\n  class Alert {\n    integer id\n    datetime created_at\n    string rule_id\n  }\n  Alert --* Rule\n  Alert *-- Artifact\n  Alert *-- Tag\n\n  class Artifact {\n    integer id\n    string data\n    string data_type\n    string source\n    string query\n    json metadata\n    datetime created_at\n    integer alert_id\n  }\n  Artifact --* Alert\n  Artifact *-- CPE\n  Artifact *-- Vulnerability\n  Artifact *-- DnsRecord\n  Artifact *-- Port\n  Artifact *-- ReverseDnsName\n  Artifact *-- Tag\n  Artifact -- AutonomousSystem\n  Artifact -- Geolocation\n  Artifact -- WhoisRecord\n  Artifact -- Rule\n\n  class AutonomousSystem {\n    integer id\n    integer number\n    datetime created_at\n    integer artifact_id\n  }\n  AutonomousSystem --* Artifact\n\n  class Port {\n    integer id\n    integer number\n    datetime created_at\n    integer artifact_id\n  }\n  Port --* Artifact\n\n  class CPE {\n    integer id\n    string name\n    datetime created_at\n    integer artifact_id\n  }\n  CPE --* Artifact\n\n  class Vulnerability {\n    integer id\n    string name\n    datetime created_at\n    integer artifact_id\n  }\n  Vulnerability --* Artifact\n\n  class DnsRecord {\n    integer id\n    string resource\n    string value\n    datetime created_at\n    integer artifact_id\n  }\n  DnsRecord --* Artifact\n\n  class ReverseDnsName {\n    integer id\n    string name\n    datetime created_at\n    integer artifact_id\n  }\n  ReverseDnsName --* Artifact\n\n  class WhoisRecord {\n    integer id\n    string domain\n    date created_on\n    date updated_on\n    date expires_on\n    json registrar\n    json contacts\n    datetime created_at\n    integer artifact_id\n  }\n  WhoisRecord --* Artifact\n\n  class Geolocation {\n    integer id\n    string country\n    string country_code\n    datetime created_at\n    integer artifact_id\n  }\n  Geolocation --* Artifact\n\n  class Tag {\n    integer id\n    string name\n    datetime created_at\n  }\n  Tag *-- Tagging\n\n  class Tagging {\n    integer id\n    integer tag_id\n    string rule_id\n    datetime created_at\n  }\n  Tagging --* Rule\n  Tagging --* Tag</code></pre>"},{"location":"diagrams/#er-diagram","title":"ER Diagram","text":"<pre><code>erDiagram\n    alerts {\n        datetime created_at\n        integer id PK\n        varchar rule_id FK\n    }\n\n    artifacts {\n        integer alert_id FK\n        datetime created_at\n        varchar data\n        varchar data_type\n        integer id PK\n        json metadata\n        varchar query\n        varchar source\n    }\n\n    autonomous_systems {\n        integer artifact_id FK\n        integer number\n        datetime created_at\n        integer id PK\n    }\n\n    cpes {\n        integer artifact_id FK\n        varchar name\n        datetime created_at\n        integer id PK\n    }\n\n    vulnerabilities {\n        integer artifact_id FK\n        varchar name\n        datetime created_at\n        integer id PK\n    }\n\n    dns_records {\n        integer artifact_id FK\n        datetime created_at\n        integer id PK\n        varchar resource\n        varchar value\n    }\n\n    geolocations {\n        integer artifact_id FK\n        varchar country\n        varchar country_code\n        datetime created_at\n        integer id PK\n    }\n\n    ports {\n        integer artifact_id FK\n        datetime created_at\n        integer id PK\n        integer number\n    }\n\n    reverse_dns_names {\n        integer artifact_id FK\n        datetime created_at\n        integer id PK\n        varchar name\n    }\n\n    rules {\n        datetime created_at\n        json data\n        varchar description\n        varchar id PK\n        varchar title\n        datetime updated_at\n    }\n\n    taggings {\n        datetime created_at\n        integer id PK\n        varchar rule_id\n        integer tag_id\n    }\n\n    tags {\n        datetime created_at\n        integer id PK\n        varchar name\n    }\n\n    whois_records {\n        integer artifact_id FK\n        json contacts\n        datetime created_at\n        date created_on\n        varchar domain\n        date expires_on\n        integer id PK\n        json registrar\n        date updated_on\n    }\n\n    alerts }o--|| rules : \"rule_id\"\n    artifacts }o--|| alerts : \"alert_id\"\n    autonomous_systems }o--|| artifacts : \"artifact_id\"\n    cpes }o--|| artifacts : \"artifact_id\"\n    vulnerabilities }o--|| artifacts : \"artifact_id\"\n    dns_records }o--|| artifacts : \"artifact_id\"\n    geolocations }o--|| artifacts : \"artifact_id\"\n    ports }o--|| artifacts : \"artifact_id\"\n    reverse_dns_names }o--|| artifacts : \"artifact_id\"\n    whois_records }o--|| artifacts : \"artifact_id\"</code></pre>"},{"location":"installation/","title":"Installation","text":"<p>Mihari is packaged as a Ruby Gem. Thus you can install it via <code>gem</code> command.</p> <pre><code>gem install mihari\n</code></pre> <p>Mihari uses SQLite3 as a primary database by default. Thus a gem for SQLite (<code>sqlite3</code>) is installed by default.</p> <p>If you want to use MySQL or PostgreSQL instead of SQLite3, please install a gem for that by yourself.</p> <p>MySQL</p> <pre><code>gem install mysql2\n</code></pre> <p>Note</p> <ul> <li>Mihari is tested with <code>mysql2</code> v0.5+.</li> <li>Please check brianmario/mysql2 if you have a problem with installing <code>mysql2</code>.</li> </ul> <p>PostgreSQL</p> <pre><code>gem install pg\n</code></pre> <p>Note</p> <ul> <li>Mihari is tested with <code>pg</code> v1.5+.</li> <li>Please check ged/ruby-pg if you have a problem with installing <code>pg</code>.</li> </ul>"},{"location":"installation/#with-bundler","title":"With Bundler","text":"<p>Alternatively you can use Bundler to manage dependencies.</p> <p>Gemfile</p> <pre><code>source 'https://rubygems.org'\n\ngem 'mihari'\n\n# Remove mysql2 or pg if you don't use MySQL or PostgreSQL\ngem \"mysql2\", \"~&gt; 0.5\"\ngem \"pg\", \"~&gt; 1.5\"\n</code></pre> <p><code>mihari</code> and <code>mysql2</code> or <code>pg</code> will be installed by <code>bundle install</code>.</p>"},{"location":"requirements/","title":"Requirements","text":""},{"location":"requirements/#runtime","title":"Runtime","text":"<p>Ruby 3.2+ (tested with 3.2, 3.3 and 3.4)</p>"},{"location":"requirements/#database","title":"Database","text":"<ul> <li>SQLite3</li> <li>PostgreSQL (v16+)</li> <li>MySQL (v8+)</li> </ul> <p>You need a database to make the data persistent. See Database for details.</p>"},{"location":"requirements/#optional-requirements","title":"Optional Requirements","text":"<p>Redis (v7) is needed to run Sidekiq. See Sidekiq for details.</p>"},{"location":"rule/","title":"Rule","text":"<p>Mihari has Sigma like format to describe a set of search queries to express a rule.</p> <p>Mihari has three main components to compose a rule.</p> <pre><code>graph LR\n  Analyzers[\"Analyzers (Queries)\"] --&gt; |Artifacts| Enrichers[Enrichers]\n  Enrichers --&gt; |\"(Enriched) Artifacts\"| Emitters[Emitters]\n  Emitters --&gt; |Alert| Database[(Database)]</code></pre> <ul> <li>Analyzers/Queries: a list of queries (analyzers) that builds a list of artifacts</li> <li>Enrichers: a list of enrichers that enriches a list of artifacts</li> <li>Emitters: a list of emitters that emits a list of artifacts as an alert</li> </ul> <p>An artifact has five types:</p> <ul> <li>IP address (<code>ip</code>)</li> <li>Domain (<code>domain</code>)</li> <li>URL (<code>url</code>)</li> <li>Mail (<code>mail</code>)</li> <li>Hash (<code>hash</code>)</li> </ul> <p>An alert can have multiple artifacts bundled by a rule.</p> <p>Note</p> <p>A rule is assumed to be continuously searched. An alert generated by a rule will only have new findings at that time.</p> <p>Let's break down the following example:</p> <pre><code>id: c7f6968e-dbe1-4612-b0bb-8407a4fe05df\ntitle: Example\ndescription: Mihari rule example\ncreated_on: \"2023-01-01\"\nupdated_on: \"2023-01-02\"\nauthor: ninoseki\nreferences:\n  - https://github.com/ninoseki/mihari\nrelated:\n  - 6254bb74-5e5d-42ad-bc1e-231da0293b0f\ntags:\n  - foo\n  - bar\nqueries:\n  - analyzer: shodan\n    query: ip:1.1.1.1\n  - analyzer: censys\n    query: ip:8.8.8.8\nenrichers:\n  - enricher: whois\n  - enricher: mmdb\n  - enricher: shodan\n  - enricher: google_public_dns\nemitters:\n  - emitter: database\n  - emitter: misp\n  - emitter: slack\n  - emitter: thehive\ndata_types:\n  - hash\n  - ip\n  - domain\n  - url\n  - mail\nfalsepositives: []\nartifact_ttl: null\n</code></pre>"},{"location":"rule/#components","title":"Components","text":""},{"location":"rule/#id","title":"ID","text":"<p><code>id</code> (<code>string</code>) is an unique ID of a rule. UUID v4 is recommended.</p>"},{"location":"rule/#title","title":"Title","text":"<p><code>title</code> (<code>string</code>) is a title of a rule.</p>"},{"location":"rule/#description","title":"Description","text":"<p><code>description</code> (<code>string</code>) is a short description of a rule.</p>"},{"location":"rule/#createdupdated-on","title":"Created/Updated On","text":"<p><code>created_on</code> (<code>date</code>) is a date of a rule creation. Optional. Also a rule can have <code>updated_on</code> that is a date of a rule modification. Optional.</p>"},{"location":"rule/#tags","title":"Tags","text":"<p><code>tags</code> (<code>array[:string]</code>) is a list of tags of a rule. Optional. Defaults to <code>[]</code>.</p>"},{"location":"rule/#author","title":"Author","text":"<p><code>author</code> (<code>string</code>) is an author of a rule. Optional.</p>"},{"location":"rule/#references","title":"References","text":"<p><code>references</code> (<code>array[:string]</code>) is a list of a references of a rule. Optional.</p>"},{"location":"rule/#related","title":"Related","text":"<p><code>related</code> (<code>array[:string]</code>) is a list of related rule IDs. Optional.</p>"},{"location":"rule/#queries","title":"Queries","text":"<p><code>queries</code> is a list of queries/analyzers. See Analyzers to know details of each analyzer.</p>"},{"location":"rule/#enrichers","title":"Enrichers","text":"<p><code>enrichers</code> is a list of enrichers. See Enrichers to know details of each enricher.</p> <p>Defaults to:</p> <ul> <li><code>google_public_dns</code></li> <li><code>mmdb</code></li> <li><code>shodan</code></li> <li><code>whois</code></li> </ul>"},{"location":"rule/#emitters","title":"Emitters","text":"<p><code>emitters</code> is a list of emitters. See Emitters to know details of each emitter.</p> <p>Defaults to:</p> <ul> <li><code>database</code></li> </ul>"},{"location":"rule/#data-types","title":"Data Types","text":"<p><code>data_types</code> (<code>array[:string]</code>) is a list of data (artifact) types to allow by a rule. Types not defined in here will be automatically rejected.</p> <p>Defaults to:</p> <ul> <li><code>ip</code></li> <li><code>domain</code></li> <li><code>url</code></li> <li><code>mail</code></li> <li><code>hash</code></li> </ul>"},{"location":"rule/#false-positives","title":"False positives","text":"<p><code>falsepositives</code> (<code>array[:string]</code>) is a list of false positive values. Optional. A string or regexp can be used in here.</p> <p>For example,</p> <pre><code>falsepositives:\n  - 127.0.0.1\n  - /^example\\.(com|net)$/\n</code></pre> <p>rejects:</p> <ul> <li><code>127.0.0.1</code></li> <li><code>example.com</code></li> <li><code>example.net</code></li> </ul>"},{"location":"rule/#artifact-ttl","title":"Artifact TTL","text":"<p><code>artifact_ttl</code> (<code>integer</code>) is an integer value of artifact TTL (Time-To-Live) in seconds. Optional.</p> <p>Mihari rejects a duplicated artifact in a rule by default.</p> <p>But you may want to get a same artifact after a certain period of time. <code>artifact_ttl</code> is for that. If a rule finds a same artifact after <code>artifact_ttl</code> seconds have been passed, that artifact will be included in an alert.</p>"},{"location":"rule/#how-to-run-a-rule","title":"How to Run a Rule","text":"<p>Once you finish writing a rule, you can run the rule by <code>mihari</code> CLI.</p> <p>Note</p> <p>You have to initialize the database by <code>mihari db migrate</code> if you haven't already done.</p> <pre><code>mihari search /path/to/rule.yml\n</code></pre> <p>The command outputs an alert to the standard output. Also you can confirm it via CLI or web app.</p> <pre><code>mihari alert list\n# or\nmihari web\n</code></pre>"},{"location":"tags/","title":"Tags","text":""},{"location":"tags/#tag:artifactdomain","title":"Artifact:Domain","text":"<ul> <li>            OTX          </li> <li>            PassiveTotal          </li> <li>            Pulsedive          </li> <li>            SecurityTrails          </li> <li>            Validin          </li> <li>            VirusTotal          </li> <li>            VirusTotal Intelligence          </li> <li>            crt.sh          </li> <li>            dnstwister          </li> <li>            urlscan.io          </li> </ul>"},{"location":"tags/#tag:artifacthash","title":"Artifact:Hash","text":"<ul> <li>            VirusTotal Intelligence          </li> </ul>"},{"location":"tags/#tag:artifactip","title":"Artifact:IP","text":"<ul> <li>            CIRCL Passive DNS/SSL          </li> <li>            Censys          </li> <li>            Fofa          </li> <li>            GreyNoise          </li> <li>            Hunter How          </li> <li>            ONYPHE          </li> <li>            OTX          </li> <li>            PassiveTotal          </li> <li>            Pulsedive          </li> <li>            SecurityTrails          </li> <li>            Shodan          </li> <li>            Validin          </li> <li>            VirusTotal          </li> <li>            VirusTotal Intelligence          </li> <li>            ZoomEye          </li> <li>            urlscan.io          </li> </ul>"},{"location":"tags/#tag:artifacturl","title":"Artifact:URL","text":"<ul> <li>            VirusTotal Intelligence          </li> <li>            urlscan.io          </li> </ul>"},{"location":"tags/#tag:enrichmentautonomous_system","title":"Enrichment:Autonomous_System","text":"<ul> <li>            MMDB          </li> </ul>"},{"location":"tags/#tag:enrichmentcpe","title":"Enrichment:CPE","text":"<ul> <li>            Shodan (The InternetDB API)          </li> </ul>"},{"location":"tags/#tag:enrichmentdns_record","title":"Enrichment:DNS_Record","text":"<ul> <li>            Google Public DNS          </li> </ul>"},{"location":"tags/#tag:enrichmentgeolocation","title":"Enrichment:Geolocation","text":"<ul> <li>            MMDB          </li> </ul>"},{"location":"tags/#tag:enrichmentport","title":"Enrichment:Port","text":"<ul> <li>            Shodan (The InternetDB API)          </li> </ul>"},{"location":"tags/#tag:enrichmentreverse_dns_name","title":"Enrichment:Reverse_DNS_Name","text":"<ul> <li>            Shodan (The InternetDB API)          </li> </ul>"},{"location":"tags/#tag:enrichmentvulnerability","title":"Enrichment:Vulnerability","text":"<ul> <li>            Shodan (The InternetDB API)          </li> </ul>"},{"location":"tags/#tag:enrichmentwhois_record","title":"Enrichment:Whois_Record","text":"<ul> <li>            Whois          </li> </ul>"},{"location":"tags/#tag:passive-dns","title":"Passive DNS","text":"<ul> <li>            CIRCL Passive DNS/SSL          </li> <li>            OTX          </li> <li>            PassiveTotal          </li> <li>            Pulsedive          </li> <li>            SecurityTrails          </li> <li>            Validin          </li> <li>            VirusTotal          </li> </ul>"},{"location":"tags/#tag:passive-ssl","title":"Passive SSL","text":"<ul> <li>            CIRCL Passive DNS/SSL          </li> <li>            PassiveTotal          </li> </ul>"},{"location":"tags/#tag:reverse-whois","title":"Reverse Whois","text":"<ul> <li>            PassiveTotal          </li> <li>            SecurityTrails          </li> <li>            Validin          </li> </ul>"},{"location":"usage/","title":"Usage","text":""},{"location":"usage/#cli","title":"CLI","text":"<pre><code>$ mihari\nCommands:\n  mihari --version, -v        # Print the version\n  mihari alert                # Sub commands for alert\n  mihari artifact             # Sub commands for artifact\n  mihari config               # Sub commands for config\n  mihari db                   # Sub commands for DB\n  mihari help [COMMAND]       # Describe available commands or one specific command\n  mihari rule                 # Sub commands for rule\n  mihari search [PATH_OR_ID]  # Search by a rule\n  mihari sidekiq              # Start Sidekiq\n  mihari tag                  # Sub commands for tag\n  mihari web                  # Start the web app\n\nOptions:\n  -d, [--debug], [--no-debug]  # Set up debug mode\n</code></pre>"},{"location":"usage/#mihari-alert","title":"<code>mihari alert</code>","text":"<pre><code>$ mihari alert\nCommands:\n  mihari alert create PATH                                   # Create an alert\n  mihari alert delete ID                                     # Delete an alert\n  mihari alert get ID                                        # Get an alert\n  mihari alert help [COMMAND]                                # Describe subcommands or one specific subcommand\n  mihari alert list QUERY                                    # List/search alerts\n  mihari alert list-transform QUERY -t, --template=TEMPLATE  # List/search alerts with transformation\n</code></pre>"},{"location":"usage/#mihari-artifact","title":"<code>mihari artifact</code>","text":"<pre><code>$ mihari artifact\nCommands:\n  mihari artifact delete ID                                     # Delete an artifact\n  mihari artifact enrich ID                                     # Enrich an artifact\n  mihari artifact get ID                                        # Get an artifact\n  mihari artifact help [COMMAND]                                # Describe subcommands or one specific subcommand\n  mihari artifact list QUERY                                    # List/search artifacts\n  mihari artifact list-transform QUERY -t, --template=TEMPLATE  # List/search artifacts with transformation\n</code></pre> <p>Note</p>"},{"location":"usage/#mihari-db","title":"<code>mihari db</code>","text":"<p>This subcommand is for initializing/migrating database.</p> <pre><code>$ mihari db\nCommands:\n  mihari db help [COMMAND]  # Describe subcommands or one specific subcommand\n  mihari db migrate         # Migrate DB schemas\n</code></pre> <p>See Database for detailed database configuration.</p>"},{"location":"usage/#mihari-rule","title":"<code>mihari rule</code>","text":"<pre><code>$ mihari rule\nCommands:\n  mihari rule delete ID                                     # Delete a rule\n  mihari rule format PATH                                   # format a rule\n  mihari rule get ID                                        # Get a rule\n  mihari rule help [COMMAND]                                # Describe subcommands or one specific subcommand\n  mihari rule init PATH                                     # Initialize a new rule\n  mihari rule list QUERY                                    # List/search rules\n  mihari rule list-transform QUERY -t, --template=TEMPLATE  # List/search rules with transformation\n  mihari rule search PATH_OR_ID                             # Search by a rule\n  mihari rule validate PATH                                 # Validate rule(s)\n</code></pre>"},{"location":"usage/#mihari-search","title":"<code>mihari search</code>","text":"<p>This is a command to execute a rule. A shorthand for <code>mihari rule search</code>.</p> <pre><code>mihari search /path/to/rule.yml\n</code></pre> <p>Mihari asks whether really you want to update a rule if there is a diff by default.</p> <pre><code>$ mihari search /path/to/rule.yml\nAre you sure you want to overwrite this rule? (y/n)\n</code></pre> <p>It can be suppressed by providing <code>-f</code>.</p> <pre><code>mihari search -f /path/to/rule.yml\n</code></pre>"},{"location":"usage/#mihari-tag","title":"<code>mihari tag</code>","text":"<pre><code>$ mihari tag\nCommands:\n  mihari tag delete ID                                     # Delete a tag\n  mihari tag help [COMMAND]                                # Describe subcommands or one specific subcommand\n  mihari tag list QUERY                                    # List/search tags\n  mihari tag list-transform QUERY -t, --template=TEMPLATE  # List/search tags with transformation\n</code></pre>"},{"location":"usage/#mihari-web","title":"<code>mihari web</code>","text":"<p>This command is for starting the built-in web app.</p> <pre><code>mihari web\n</code></pre> <p>It stars the app with <code>localhost:9292</code>. You can configure it by providing following options:</p> <pre><code>$ mihari help web\nUsage:\n  mihari web\n\nOptions:\n      [--port=N]                   # Port to listen on\n                                   # Default: 9292\n      [--host=HOST]                # Hostname to listen on\n                                   # Default: localhost\n      [--threads=THREADS]          # min:max threads to use\n                                   # Default: 0:3\n      [--verbose], [--no-verbose]  # Don't report each request\n                                   # Default: false\n      [--worker-timeout=N]         # Worker timeout value (in seconds)\n                                   # Default: 60\n      [--open], [--no-open]        # Whether to open the app in browser or not\n                                   # Default: true\n      [--env=ENV]                  # Environment\n                                   # Default: production\n  -d, [--debug], [--no-debug]      # Set up debug mode\n</code></pre> <p>Tip</p> <p>The built-in web app offers API to interact with Mihari. The API docs are available on <code>/redoc-static.html</code>.</p>"},{"location":"usage/#mihari-sidekiq","title":"<code>mihari sidekiq</code>","text":"<p>This command is for starting Sidekiq. See Sidekiq for details.</p> <pre><code>$ mihari help sidekiq\nUsage:\n  mihari sidekiq\n\nOptions:\n      [--env=ENV]              # Environment\n                               # Default: production\n  -c, [--concurrency=N]        # Sidekiq concurrency\n                               # Default: 5\n</code></pre>"},{"location":"usage/#hints","title":"Hints","text":""},{"location":"usage/#search","title":"Search","text":"<p>Mihari provides listing/search feature via CLI &amp; API.</p> <p>Search query supports <code>AND</code>, <code>OR</code>, <code>:</code>, <code>=</code>, <code>!=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>NOT</code> and <code>()</code>.</p> <p>Searchable fields are:</p> Type Searchable fields <code>alert</code> <code>id</code>, <code>tag</code>, <code>created_at</code>, <code>rule.id</code>, <code>rule.title</code>, <code>rule.description</code>, <code>artifact.data</code>, <code>artifact.data_type</code>, <code>artifact.source</code> and <code>artifact.query</code> <code>artifact</code> <code>id</code>, <code>data</code>, <code>data_type</code>, <code>source</code>, <code>query</code>, <code>tag</code>, <code>rule.id</code>, <code>rule.title</code>, <code>rule.description</code>, <code>tag</code>,<code>created_at</code>, <code>asn</code>, <code>country_code</code>, <code>dns_record.value</code>, <code>dns_record.resource</code>, <code>reverse_dns_name</code>, <code>cpe</code>, <code>vuln</code> and <code>port</code> <code>rule</code> <code>id</code>, <code>title</code>, <code>description</code>, <code>tag</code>, <code>created_at</code> and <code>updated_at</code> <code>tag</code> <code>id</code> and <code>name</code> <p>Examples</p> <pre><code>mihari rule list \"description:foo OR title:bar\"\nmihari alert list \"rule.id:foo\"\nmihari artifact list \"rule.id: foo AND data_type:ip\"\n</code></pre>"},{"location":"usage/#search-with-transformation","title":"Search With Transformation","text":"<p>Additionally you can search rules, alerts and artifacts with transformation by using Jbuilder.</p> <pre><code>mihari rule list-transform -t /path/to/template\nmihari alert list-transform -t /path/to/template\nmihari artifact list-transform -t /path/to/template\n</code></pre> <p>For example, you can combine IP addresses and ports by using the following template.</p> <p>ip_port.json.jbuilder</p> <pre><code>ip_ports = results.map do |artifact|\n  artifact.ports.map do |port|\n    \"#{artifact.data}:#{port.number}\"\n  end\nend.flatten\n\njson.array! ip_ports\n</code></pre> <pre><code>mihari artifact list-transform -t /path/to/ip_port.json.jbuilder\n</code></pre> <p>A template can use the following attributes.</p> Key Type Desc. <code>results</code> <code>Array[Mihari::Models::Rule]</code>, <code>Array[Mihari::Models::Alert]</code>, <code>Array[Mihari::Models::Artifact]</code> or <code>Array[Mihari::Models::Tag]</code> A list of search results <code>total</code> Integer A total number of search results <code>page_size</code> Integer A page size <code>current_page</code> Integer A current page number <p>Warning</p> <p>With great power comes great responsibility.</p> <p>Jbuilder can execute anything with the same privilege Mihari has. Do not use untrusted template.</p>"},{"location":"analyzers/","title":"Analyzers","text":"<ul> <li>Censys (Search API v2)</li> <li>Censys Platform API (v3)</li> <li>Circle Passive DNS/SSL</li> <li>crt.sh</li> <li>dnstwister</li> <li>Feed</li> <li>Fofa</li> <li>GreyNoise</li> <li>HunterHow</li> <li>Onyphe</li> <li>OTX</li> <li>PassiveTotal</li> <li>PulseDive</li> <li>SecurityTrails</li> <li>Shodan</li> <li>urlscan.io</li> <li>Validin</li> <li>VirusTotal</li> <li>VirusTotal Intelligence</li> <li>ZoomEye</li> </ul>"},{"location":"analyzers/#options","title":"Options","text":"<p>All the analyzers can have optional <code>options</code>.</p> <pre><code>analyzer: ...\nquery: ...\noptions:\n  retry_times: ...\n  retry_interval: ...\n  retry_exponential_backoff: ...\n  timeout: ...\n  ignore_error: ...\n  parallel: ...\n</code></pre> <p>Also the following analyzers can have pagination options.</p> <ul> <li>Censys</li> <li>Fofa</li> <li>GreyNoise</li> <li>HunterHow</li> <li>Onyphe</li> <li>Shodan</li> <li>urlscan.io</li> <li>VirusTotal Intelligence</li> </ul> <pre><code>options:\n  pagination_interval: ...\n  pagination_limit: ...\n</code></pre>"},{"location":"analyzers/#retry-times","title":"Retry Times","text":"<p><code>retry_times</code> (<code>integer</code>) is a number of times of retry when something goes wrong. Optional. Defaults to 3. Configurable via <code>RETRY_TIMES</code> environment variable.</p>"},{"location":"analyzers/#retry-interval","title":"Retry Interval","text":"<p><code>retry_interval</code> (<code>integer</code>) is an interval in seconds between retries. Optional. Defaults to 5. Configurable via <code>RETRY_INTERVAL</code> environment variable.</p>"},{"location":"analyzers/#retry-exponential-backoff","title":"Retry Exponential Backoff","text":"<p><code>retry_exponential_backoff</code> (<code>bool</code>) controls whether to do exponential backoff. Optional. Defaults to <code>true</code>. Configurable via <code>RETRY_EXPONENTIAL_BACKOFF</code> environment variable.</p>"},{"location":"analyzers/#timeout","title":"Timeout","text":"<p><code>timeout</code> (<code>integer</code>) is an HTTP timeout in seconds. Optional.</p>"},{"location":"analyzers/#ignore-error","title":"Ignore Error","text":"<p><code>ignore_error</code> (<code>bool</code>) controls whether to ignore an error or not. Optional. Defaults to <code>false</code>.</p> <p>Mihari uses fail-fast approach. For example, if the first Shodan analyzer fails, the second Censys analyzer will not be triggered because Mihari will fail before it.</p> <pre><code>queries:\n  - analyzer: shodan\n    query: ip:1.1.1.1\n  - analyzer: censys\n    query: ip:8.8.8.8\n</code></pre> <p>You can set <code>ignore_error</code> option to make it fault-tolerant.</p> <pre><code>queries:\n  - analyzer: shodan\n    query: ip:1.1.1.1\n    options:\n      ignore_error: true\n  - analyzer: censys\n    query: ip:8.8.8.8\n</code></pre>"},{"location":"analyzers/#parallel","title":"Parallel","text":"<p><code>parallel</code> (<code>bool</code>) controls whether to allow parallel execution or not. Optional. Defaults to <code>false</code>. Configurable via <code>ANALYZER_PARALLELISM</code> environment variable.</p>"},{"location":"analyzers/#pagination-interval","title":"Pagination Interval","text":"<p><code>pagination_interval</code> (<code>integer</code>) is an interval in seconds between pagination. Optional. Defaults to 0. Configurable via <code>PAGINATION_INTERVAL</code> environment variable.</p>"},{"location":"analyzers/#pagination-limit","title":"Pagination Limit","text":"<p><code>pagination_limit</code> (<code>integer</code>) is an limit for pagination. Optional. Defaults to 100. Configurable via <code>PAGINATION_LIMIT</code> environment variable.</p> <p>In the worst case, if something wrong with Mihari or a service, Mihari can drain API quota by doing pagination forever. <code>pagination_limit</code> is a safety valve for that. A number of pagination is limited as <code>pagination_limit</code> times.</p>"},{"location":"analyzers/censys/","title":"Censys","text":"<ul> <li>https://censys.io/</li> </ul> <p>This analyzer uses Censys Search 2.0 REST API to search. Pagination is supported.</p> <pre><code>analyzer: censys\nquery: ...\nversion: 2\n# v2\nid: ...\nsecret: ...\n# v3\napi_key: ...\norganization_id: ...\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/censys/#components","title":"Components","text":"","tags":["Artifact:IP"]},{"location":"analyzers/censys/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP"]},{"location":"analyzers/censys/#version","title":"Version","text":"<p><code>version</code> (<code>integer</code>) indicates an API version. 2 or 3. Defaults to 2. Configurable via <code>CENSYS_VERSION</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/censys/#id","title":"ID","text":"<p><code>id</code> (<code>string</code>) is a Cencys ID for the v2 API. Optional. Configurable via <code>CENSYS_ID</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/censys/#secret","title":"Secret","text":"<p><code>secret</code> (<code>string</code>) is a Cencys secret for the v2 API. Optional. Configurable via <code>CENSYS_SECRET</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/censys/#pat","title":"PAT","text":"<p><code>pat</code> (<code>string</code>) is a Personal Access Token for the v3 API. Optional. Configurable via <code>CENSYS_PAT</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/censys/#organization-id","title":"Organization ID","text":"<p><code>organization_id</code> (<code>string</code>) is an organization ID for the v3 API. Optional. Configurable via <code>CENSYS_ORGANIZATION_ID</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/censys/#examples","title":"Examples","text":"<p>v2</p> <pre><code>analyzer: censys\nquery: \"ip:1.1.1.1\"\nversion: 2\n</code></pre> <p>v3</p> <pre><code>analyzer: censys\nquery: \"host.ip:1.1.1.1\"\nversion: 3\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/circl/","title":"CIRCL Passive DNS/SSL","text":"<ul> <li>https://www.circl.lu/services/passive-dns/</li> <li>https://www.circl.lu/services/passive-ssl/</li> </ul> <p>This analyzer uses CIRCL passive DNS API or passive SSL API:</p> <ul> <li>Use passive DNS API if a query is a domain.</li> <li>Use passive SSL API if a query is a SHA1 certificate fingerprint.</li> </ul> <pre><code>analyzer: circl\nquery: ...\npassword: ...\nusername: ...\n</code></pre>","tags":["Artifact:IP","Passive DNS","Passive SSL"]},{"location":"analyzers/circl/#components","title":"Components","text":"","tags":["Artifact:IP","Passive DNS","Passive SSL"]},{"location":"analyzers/circl/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a domain or SHA1 certificate fingerprint.</p>","tags":["Artifact:IP","Passive DNS","Passive SSL"]},{"location":"analyzers/circl/#username","title":"Username","text":"<p><code>username</code> (<code>string</code>) is a username. Optional. Configurable via <code>CIRCL_PASSIVE_USERNAME</code>.</p>","tags":["Artifact:IP","Passive DNS","Passive SSL"]},{"location":"analyzers/circl/#password","title":"Password","text":"<p><code>password</code> (<code>string</code>) is a password. Optional. Configurable via <code>CIRCL_PASSIVE_PASSWORD</code>.</p>","tags":["Artifact:IP","Passive DNS","Passive SSL"]},{"location":"analyzers/crtsh/","title":"crt.sh","text":"<ul> <li>https://crt.sh/</li> </ul> <p>This analyzer uses crt.sh's (unofficial?) REST API.</p> <pre><code>analyzer: crtsh\nquery: ...\nexclude_expired: ...\nmatch: ...\n</code></pre>","tags":["Artifact:Domain"]},{"location":"analyzers/crtsh/#components","title":"Components","text":"","tags":["Artifact:Domain"]},{"location":"analyzers/crtsh/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:Domain"]},{"location":"analyzers/crtsh/#exclude-expired","title":"Exclude Expired","text":"<p><code>exclude_expired</code> (<code>boolean</code>) determines whether to exclude expired domains or not. Optional. Defaults to <code>true</code>.</p>","tags":["Artifact:Domain"]},{"location":"analyzers/crtsh/#match","title":"Match","text":"<p><code>match</code> (<code>string</code>) is an identity matching option. <code>=</code>, <code>ILIKE</code>, <code>LIKE</code>, <code>single</code>, <code>any</code> or <code>FTS</code>. Optional.</p>","tags":["Artifact:Domain"]},{"location":"analyzers/dnstwister/","title":"dnstwister","text":"<ul> <li>https://dnstwister.report/</li> </ul> <p>This analyzer uses dnstwister API to search.</p> <pre><code>analyzer: dnstwister\nquery: ...\n</code></pre>","tags":["Artifact:Domain"]},{"location":"analyzers/dnstwister/#components","title":"Components","text":"","tags":["Artifact:Domain"]},{"location":"analyzers/dnstwister/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p> <p>Tip</p> <p>There is no need to input a domain in hexadecimal format. This analyzer automatically converts a domain (in string format) into a hexadecimal value.</p>","tags":["Artifact:Domain"]},{"location":"analyzers/feed/","title":"Feed","text":"<p>This analyzer can ingest a feed (JSON or CSV) by specifying conditions.</p> <p>Note that you should write a selector to get proper IoCs from a feed. A selector is based on jr.</p> <pre><code>analyzer: feed\nquery: ...\nselector: ...\nmethod: ...\nheaders: ...\nparams: ...\nform: ...\njson: ...\n</code></pre>"},{"location":"analyzers/feed/#components","title":"Components","text":""},{"location":"analyzers/feed/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a URL of a feed.</p> <p>Note</p> <p>I know this is a strange naming. It's just for keeping the convention with other analyzers.</p>"},{"location":"analyzers/feed/#method","title":"Method","text":"<p><code>method</code> (<code>string</code>) is an HTTP method. Defaults to <code>GET</code>.</p>"},{"location":"analyzers/feed/#selector","title":"Selector","text":"<p><code>selector</code> (<code>string</code>) is a <code>jr</code> selector.</p> <p>Warning</p> <p>With great power comes great responsibility.</p> <p><code>jr</code> can execute anything with the same privilege Mihari has. Do not use untrusted selector.</p>"},{"location":"analyzers/feed/#headers","title":"Headers","text":"<p><code>headers</code> (<code>hash</code>) is an HTTP headers. Optional.</p>"},{"location":"analyzers/feed/#params","title":"Params","text":"<p><code>params</code> (<code>hash</code>) is an HTTP query params. Optional.</p>"},{"location":"analyzers/feed/#form","title":"Form","text":"<p><code>form</code> (<code>hash</code>) is an HTTP form data. Optional.</p>"},{"location":"analyzers/feed/#json","title":"JSON","text":"<p><code>json</code> (<code>hash</code>) is a JSON data. Optional.</p>"},{"location":"analyzers/feed/#examples","title":"Examples","text":""},{"location":"analyzers/feed/#threatfox","title":"ThreatFox","text":"<pre><code>analyzer: feed\nquery: \"https://threatfox-api.abuse.ch/api/v1/\"\nmethod: POST\njson:\n  query: get_iocs\nheaders:\nselector: \"data.map(&amp;:ioc).map { |v| v.start_with?('http://', 'https://') ? v :  v.split(':').first }\"\n</code></pre>"},{"location":"analyzers/feed/#urlhaus","title":"URLhaus","text":"<pre><code>analyzer: feed\nquery: \"https://urlhaus.abuse.ch/feeds/country/JP/\"\nselector: \"map { |v| v[1] }\"\n</code></pre>"},{"location":"analyzers/fofa/","title":"Fofa","text":"<ul> <li>https://en.fofa.info/</li> </ul> <p>This analyzer uses Fofa API (<code>/api/v1/search/all</code>) to search. Pagination is supported.</p> <pre><code>analyzer: fofa\nquery: ...\napi_key: ...\nemail: ...\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/fofa/#components","title":"Components","text":"","tags":["Artifact:IP"]},{"location":"analyzers/fofa/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP"]},{"location":"analyzers/fofa/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>FOFA_API_KEY\"</code>.</p>","tags":["Artifact:IP"]},{"location":"analyzers/fofa/#email","title":"Email","text":"<p><code>email</code> (<code>string</code>) is an email. Optional. Configurable via <code>FOFA_EMAIL</code>.</p>","tags":["Artifact:IP"]},{"location":"analyzers/greynoise/","title":"GreyNoise","text":"<ul> <li>https://www.greynoise.io/</li> </ul> <p>This analyzer uses GreyNoise API (<code>/v2/experimental/gnql</code>) to search. Pagination is supported.</p> <pre><code>analyzer: greynoise\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/greynoise/#components","title":"Components","text":"","tags":["Artifact:IP"]},{"location":"analyzers/greynoise/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a GNQL search query.</p>","tags":["Artifact:IP"]},{"location":"analyzers/greynoise/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>GREYNOISE_API_KEY</code>.</p>","tags":["Artifact:IP"]},{"location":"analyzers/hunterhow/","title":"Hunter How","text":"<ul> <li>https://hunter.how/</li> </ul> <p>This analyzer uses Hunter How API (<code>https://api.hunter.how/search</code>) to search. Pagination is supported.</p> <pre><code>analyzer: hunterhow\nquery: ...\napi_key: ...\nstart_time: ...\nend_time: ...\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/hunterhow/#components","title":"Components","text":"","tags":["Artifact:IP"]},{"location":"analyzers/hunterhow/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP"]},{"location":"analyzers/hunterhow/#startend-time","title":"Start/End Time","text":"<ul> <li><code>start_time</code> (<code>date</code>): Only show results after the given date.</li> <li><code>end_time</code> (<code>date</code>): Only show results after the given date.</li> </ul>","tags":["Artifact:IP"]},{"location":"analyzers/hunterhow/#api-key","title":"API key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>HUNTERHOW_API_KEY</code>.</p>","tags":["Artifact:IP"]},{"location":"analyzers/onyphe/","title":"ONYPHE","text":"<ul> <li>https://www.onyphe.io/</li> </ul> <p>This analyzer uses ONYPHE API v2 (<code>/api/v2/simple/datascan</code>) to search.</p> <pre><code>analyzer: onyphe\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/onyphe/#components","title":"Components","text":"","tags":["Artifact:IP"]},{"location":"analyzers/onyphe/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP"]},{"location":"analyzers/onyphe/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>ONYPHE_API_KEY</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/otx/","title":"OTX","text":"<ul> <li>https://otx.alienvault.com/</li> </ul> <p>This analyzer uses OTX API v1 (<code>/api/v1/indicators/</code>) API to search.</p> <pre><code>analyzer: otx\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/otx/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/otx/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a passive DNS search query. Domain or IP address.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/otx/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>OTX_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/passivetotal/","title":"PassiveTotal","text":"<ul> <li>https://community.riskiq.com/</li> </ul> <p>This analyzer uses PassvieTotal API.</p> <p>An API endpoint to use is changed based on a type of a query.</p> Query API endpoint Artifact IP address <code>/v2/dns/passive</code> Domain Domain <code>/v2/dns/passive</code> IP address Mail <code>/v2/whois/search</code> Domain Hash (SSL certificate SHA1 fingerprint) <code>/v2/ssl-certificate/history</code> IP address <pre><code>analyzer: passivetotal\nquery: ...\nusername: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Passive SSL","Reverse Whois"]},{"location":"analyzers/passivetotal/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Passive SSL","Reverse Whois"]},{"location":"analyzers/passivetotal/#analyzer","title":"Analyzer","text":"<p><code>analyzer</code> (<code>string</code>) should be either of <code>passivetotal</code> and <code>pt</code>.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Passive SSL","Reverse Whois"]},{"location":"analyzers/passivetotal/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a passive DNS/SSL or reverse whois search query. Domain, IP address, mail or SHA1 certificate fingerprint.</p> <ul> <li>Passive DNS: Domain, IP Address</li> <li>Passive SSL: SHA1 certificate fingerprint</li> <li>Reverse whois: mail</li> </ul>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Passive SSL","Reverse Whois"]},{"location":"analyzers/passivetotal/#username","title":"Username","text":"<p><code>username</code> (<code>string</code>) is a username. Optional. Configurable via <code>PASSIVETOTAL_USERNAME</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Passive SSL","Reverse Whois"]},{"location":"analyzers/passivetotal/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>PASSIVETOTAL_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Passive SSL","Reverse Whois"]},{"location":"analyzers/pulsedive/","title":"Pulsedive","text":"<ul> <li>https://pulsedive.com/</li> </ul> <p>This analyzer uses Pulsedive API (<code>/api/info.php</code>) to search.</p> <pre><code>analyzer: pulsedive\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/pulsedive/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/pulsedive/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a passive DNS search query. Domain or IP address.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/pulsedive/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>PULSEDIVE_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/securitytrails/","title":"SecurityTrails","text":"<ul> <li>https://securitytrails.com/</li> </ul> <p>This analyzer uses SecurityTrails API.</p> <p>An API endpoint to use is changed based on a type of a query.</p> Query type API endpoint Artifact IP address <code>/v1/domains/list</code> Domain Domain <code>/v1/history/</code> IP address Mail <code>/v1/domains/list</code> Domain <pre><code>analyzer: securitytrails\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/securitytrails/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/securitytrails/#analyzer","title":"Analyzer","text":"<p><code>analyzer</code> (<code>string</code>) should be either of <code>securitytrails</code> and <code>st</code>.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/securitytrails/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a passive DNS search/reverse whois query. Domain, IP address or mail.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/securitytrails/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>SECURITYTRAILS_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/shodan/","title":"Shodan","text":"<ul> <li>https://shodan.io/</li> </ul> <p>This analyzer uses Shodan REST AP (<code>/shodan/host/search</code>) API to search. Pagination is supported.</p> <pre><code>analyzer: shodan\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/shodan/#components","title":"Components","text":"","tags":["Artifact:IP"]},{"location":"analyzers/shodan/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP"]},{"location":"analyzers/shodan/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>SHODAN_API_KEY</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/urlscan/","title":"urlscan.io","text":"<ul> <li>https://urlscan.io/</li> </ul> <p>This analyzer uses urlscan.io API (<code>/api/v1/search</code>) to search. Pagination is supported.</p> <pre><code>analyzer: urlscan\nquery: ...\napi_key: ...\ndata_types: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL"]},{"location":"analyzers/urlscan/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Artifact:URL"]},{"location":"analyzers/urlscan/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL"]},{"location":"analyzers/urlscan/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>URLSCAN_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL"]},{"location":"analyzers/urlscan/#data-types","title":"Data Types","text":"<p>A list of data types allowed.</p> <p>Defaults to:</p> <ul> <li><code>ip</code></li> <li><code>domain</code></li> <li><code>url</code></li> </ul>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL"]},{"location":"analyzers/validin/","title":"Validin","text":"<ul> <li>https://www.validin.com/</li> </ul> <p>This analyzer uses Validin API.</p> <p>An API endpoint to use is changed based on a type of a query.</p> Query type API endpoint Artifact IP address <code>/api/axon/domain/dns/history/:domain/A</code> Domain Domain <code>/api/axon/ip/dns/history/:ip</code> IP address <pre><code>analyzer: validin\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/validin/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/validin/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a domain or an IP address.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/validin/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>VALIDIN_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS","Reverse Whois"]},{"location":"analyzers/virustotal/","title":"VirusTotal","text":"<ul> <li>https://www.virustotal.com</li> </ul> <p>This analyzer uses VirusTotal API v3.</p> <p>An API endpoint to use is changed based on a type of a query.</p> <p>::: top</p> <pre><code>Note that this analyzer only checks passive DNS data of a given query (domain or IP address).\n</code></pre> Query API endpoint Artifact IP address <code>/api/v3/ip_addresses/</code> Domain Domain <code>/api/v3/domains/</code> IP address <pre><code>analyzer: virustotal\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/virustotal/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/virustotal/#analyzer","title":"Analyzer","text":"<p><code>analyzer</code> (<code>string</code>) should be either of <code>virustoal</code> and <code>vt</code>.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/virustotal/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a passive DNS search query. Domain or IP address.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/virustotal/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>VIRUSTOTAL_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Passive DNS"]},{"location":"analyzers/virustotal_intelligence/","title":"VirusTotal Intelligence","text":"<ul> <li>https://www.virustotal.com</li> </ul> <p>This analyzer uses VirusTotal Intelligence API. Pagination is supported.</p> <pre><code>analyzer: virustotal_intelligence\nquery: ...\napi_key: ...\n</code></pre>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL","Artifact:Hash"]},{"location":"analyzers/virustotal_intelligence/#components","title":"Components","text":"","tags":["Artifact:IP","Artifact:Domain","Artifact:URL","Artifact:Hash"]},{"location":"analyzers/virustotal_intelligence/#analyzer","title":"Analyzer","text":"<p><code>analyzer</code> (<code>string</code>) should be either of <code>virustotal_intelligence</code> and <code>vt_intel</code>.</p>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL","Artifact:Hash"]},{"location":"analyzers/virustotal_intelligence/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL","Artifact:Hash"]},{"location":"analyzers/virustotal_intelligence/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>VIRUSTOTAL_API_KEY</code> environment variable.</p>","tags":["Artifact:IP","Artifact:Domain","Artifact:URL","Artifact:Hash"]},{"location":"analyzers/zoomeye/","title":"ZoomEye","text":"<ul> <li>https://zoomeye.ai/</li> </ul> <p>This analyzer uses ZoomEye API v2 (<code>/v2/search</code>) to search.</p> <pre><code>analyzer: zoomeye\nquery: ...\napi_key: ...\ndata_types: ...\n</code></pre>","tags":["Artifact:IP"]},{"location":"analyzers/zoomeye/#components","title":"Components","text":"","tags":["Artifact:IP"]},{"location":"analyzers/zoomeye/#query","title":"Query","text":"<p><code>query</code> (<code>string</code>) is a search query.</p>","tags":["Artifact:IP"]},{"location":"analyzers/zoomeye/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>ZOOMEYE_API_KEY</code> environment variable.</p>","tags":["Artifact:IP"]},{"location":"analyzers/zoomeye/#data-types","title":"Data Types","text":"<p>A list of data types allowed.</p> <p>Defaults to:</p> <ul> <li><code>ip</code></li> <li><code>domain</code></li> <li><code>url</code></li> </ul>","tags":["Artifact:IP"]},{"location":"emitters/","title":"Emitters","text":"<ul> <li>Database</li> <li>MISP</li> <li>Slack</li> <li>TheHive</li> <li>Webhook</li> <li>Yeti</li> </ul>"},{"location":"emitters/#options","title":"Options","text":"<p>All the emitters can have optional <code>options</code>.</p> <pre><code>emitter: ...\noptions:\n  timeout: ...\n  retry_times: ...\n  retry_interval: ...\n  retry_exponential_backoff: ...\n  parallel: ...\n</code></pre>"},{"location":"emitters/#timeout","title":"Timeout","text":"<p><code>timeout</code> (<code>integer</code>) is an HTTP timeout in seconds. Optional.</p>"},{"location":"emitters/#retry-times","title":"Retry Times","text":"<p><code>retry_times</code> (<code>integer</code>) is a number of times of retry when something goes wrong. Optional. Defaults to 3. Configurable via <code>RETRY_TIMES</code> environment variable.</p>"},{"location":"emitters/#retry-interval","title":"Retry Interval","text":"<p><code>retry_interval</code> (<code>integer</code>) is an interval in seconds between retries. Optional. Defaults to 5. Configurable via <code>RETRY_INTERVAL</code> environment variable.</p>"},{"location":"emitters/#retry-exponential-backoff","title":"Retry Exponential Backoff","text":"<p><code>retry_exponential_backoff</code> (<code>bool</code>) controls whether to do exponential backoff. Optional. Defaults to <code>true</code>. Configurable via <code>RETRY_EXPONENTIAL_BACKOFF</code> environment variable.</p>"},{"location":"emitters/#parallel","title":"Parallel","text":"<p><code>parallel</code> (<code>bool</code>) controls whether to allow parallel execution or not. Optional. Defaults to <code>true</code>. Configurable via <code>EMITTER_PARALLELISM</code> environment variable.</p>"},{"location":"emitters/database/","title":"Database","text":"<p>This emitter stores data in a database. This emitter uses SQLite3 by default but you can change to use MySQL or PostgreSQL. The database is a primary database of Mihari. Each data generated by Mihari is stored in the database. You can view the data via the built-in web app.</p> <pre><code>emitter: database\n</code></pre> <p>Note</p> <p>You have to initialize the database by <code>mihari db migrate</code>.</p>"},{"location":"emitters/database/#components","title":"Components","text":""},{"location":"emitters/database/#database-url","title":"Database URL","text":"<p><code>database_url</code> (<code>string</code>) is a database URL. Defaults to <code>sqlite3:mihari.db</code>. Configurable via <code>DATABASE_URL</code> environment variable.</p> <p>If you want to use MySQL or PostgreSQL, please set a database URL for that.</p> <ul> <li>MySQL: <code>mysql2://username:password@host:port/database</code> (+ <code>gem install mysql2</code>)</li> <li>PostgreSQL: <code>postgres://username:password@host:port/database</code> (+ <code>gem install pg</code>)</li> </ul>"},{"location":"emitters/hive/","title":"TheHive","text":"<ul> <li>https://thehive-project.org/</li> </ul> <p>This emitter creates an alert on TheHive. TheHive v5 is supported.</p> <pre><code>emitter: thehive\nurl: ...\napi_key: ...\nobservable_tags: ...\n</code></pre>"},{"location":"emitters/hive/#components","title":"Components","text":""},{"location":"emitters/hive/#url","title":"URL","text":"<p><code>url</code> (<code>string</code>) is a TheHive URL. Optional. Configurable via <code>THEHIVE_URL</code> environment variable.</p>"},{"location":"emitters/hive/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>THEHIVE_API_KEY</code> environment variable.</p>"},{"location":"emitters/hive/#observable-tags","title":"Observable Tags","text":"<p><code>observable_tags</code> (<code>array[:string]</code>) is a list of observable tags. Optional. Defaults to <code>[]</code>.</p> <p>Note</p> <p><code>tags</code> of a rule are set as tags of an alert.</p> <pre><code>id: ...\ntitle: ...\ndescription: ...\ntags: # tags for an alert\n  - foo\nqueries:\n  - analyzer: ...\n    query: ...\nemitters:\n  - emitter: database\n  - emitter: thehive\n    url: ...\n    api_key: ...\n    observable_tags: # tags for observable(s)\n      - bar\n</code></pre>"},{"location":"emitters/misp/","title":"MISP","text":"<ul> <li>https://www.misp-project.org/</li> </ul> <p>This emitter creates an event on MISP based on an alert. MISP v2 is supported.</p> <pre><code>emitter: misp\nurl: ...\napi_key: ...\nattribute_tags: ...\n</code></pre>"},{"location":"emitters/misp/#components","title":"Components","text":""},{"location":"emitters/misp/#url","title":"URL","text":"<p><code>url</code> (<code>string</code>) is a MISP URL. Optional. Configurable via <code>MISP_URL</code> environment variable.</p>"},{"location":"emitters/misp/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>MISP_API_KEY</code> environment variable.</p>"},{"location":"emitters/misp/#attribute-tags","title":"Attribute Tags","text":"<p><code>attribute_tags</code> (<code>array[:string]</code>) is a list of attribute tags. Optional. Defaults to <code>[]</code>.</p> <p>Note</p> <p><code>tags</code> of a rule are set as tags of an event.</p> <pre><code>id: ...\ntitle: ...\ndescription: ...\ntags: # tags for an event\n  - foo\nqueries:\n  - analyzer: ...\n    query: ...\nemitters:\n  - emitter: database\n  - emitter: misp\n    url: ...\n    api_key: ...\n    attribute_tags: # tags for attribute(s)\n      - bar\n</code></pre>"},{"location":"emitters/slack/","title":"Slack","text":"<ul> <li>https://slack.com/</li> </ul> <p>This emitter post a message to Slack via incoming webhook.</p> <pre><code>emitter: slack\nwebhook_url: ...\nchannel: ...\n</code></pre>"},{"location":"emitters/slack/#components","title":"Components","text":""},{"location":"emitters/slack/#webhook-url","title":"Webhook URL","text":"<p><code>url</code> (<code>string</code>) is a Slack's incoming webhook URL. Optional. Configurable via <code>SLACK_WEBHOOK_URL</code> environment variable.</p>"},{"location":"emitters/slack/#channel","title":"Channel","text":"<p><code>channel</code> (<code>string</code>) is a Slack channel to post a message. Defaults to <code>#general</code>. Configurable via <code>SLACK_CHANNEL</code> environment variable.</p>"},{"location":"emitters/webhook/","title":"Webhook","text":"<p>This emitter creates an HTTP request with a JSON body based on the specified conditions.</p> <pre><code>emitter: webhook\nurl: ...\nmethod: ...\nheaders: ...\ntemplate: ...\n</code></pre>"},{"location":"emitters/webhook/#components","title":"Components","text":""},{"location":"emitters/webhook/#url","title":"URL","text":"<p><code>url</code> (<code>string</code>) is a webhook URL.</p>"},{"location":"emitters/webhook/#method","title":"Method","text":"<p><code>method</code> (<code>string</code>)is an HTTP method. Optional. Defaults to <code>POST</code>.</p>"},{"location":"emitters/webhook/#headers","title":"Headers","text":"<p><code>headers</code> (<code>hash</code>) are HTTP headers. Optional.</p>"},{"location":"emitters/webhook/#template","title":"Template","text":"<p><code>template</code> (<code>string</code>) is a Jbuilder template string (or a path to a Jbuilder template file) to customize a JSON body to send.</p> <p>You can use the following attributes inside a Jbuilder template.</p> Key Type Desc. <code>rule</code> <code>Mihari::Rule</code> A rule <code>artifacts</code> <code>Array[Mihari::Models::Artifact]</code> A list of artifacts"},{"location":"emitters/webhook/#examples","title":"Examples","text":""},{"location":"emitters/webhook/#threatfox","title":"ThreatFox","text":"<pre><code>- emitter: webhook\n  url: https://threatfox-api.abuse.ch/api/v1/\n  headers:\n    auth-key: YOUR_AUTH_KEY\n  template: /path/to/threatfox.json.jbuilder\n</code></pre> <p>threatfox.json.jbuilder</p> <pre><code>json.query \"submit_ioc\"\njson.threat_type  \"payload_delivery\"\njson.ioc_type \"domain\"\njson.malware \"foobar\"\njson.confidence_level 100\njson.anonymous 0\njson.iocs artifacts.map(&amp;:data)\n</code></pre> <p>Warning</p> <p>With great power comes great responsibility.</p> <p>Jbuilder can execute anything with the same privilege Mihari has. Do not use untrusted template.</p>"},{"location":"emitters/yeti/","title":"Yeti","text":"<ul> <li>https://yeti-platform.io/</li> </ul> <p>This emitter creates observables on Yeti.</p> <pre><code>emitter: yeti\nurl: ...\napi_key: ...\n</code></pre>"},{"location":"emitters/yeti/#components","title":"Components","text":""},{"location":"emitters/yeti/#url","title":"URL","text":"<p><code>url</code> (<code>string</code>) is a Yeti URL. Optional. Configurable via <code>YETI_URL</code> environment variable.</p>"},{"location":"emitters/yeti/#api-key","title":"API Key","text":"<p><code>api_key</code> (<code>string</code>) is an API key. Optional. Configurable via <code>YETI_API_KEY</code> environment variable.</p>"},{"location":"enrichers/","title":"Enrichers","text":"<ul> <li>Google Public DNS</li> <li>MMDB</li> <li>Shodan</li> <li>Whois</li> </ul>"},{"location":"enrichers/#options","title":"Options","text":"<p>All the emitters can have optional <code>options</code>.</p> <pre><code>enricher: ...\noptions:\n  timeout: ...\n  retry_times: ...\n  retry_interval: ...\n  retry_exponential_backoff: ...\n</code></pre>"},{"location":"enrichers/#timeout","title":"Timeout","text":"<p><code>timeout</code> (<code>integer</code>) is an HTTP or Whois timeout in seconds. Optional.</p>"},{"location":"enrichers/#retry-times","title":"Retry Times","text":"<p><code>retry_times</code> (<code>integer</code>) is a number of times of retry when something goes wrong. Optional. Defaults to 3. Configurable via <code>RETRY_TIMES</code> environment variable.</p>"},{"location":"enrichers/#retry-interval","title":"Retry Interval","text":"<p><code>retry_interval</code> (<code>integer</code>) is an interval in seconds between retries. Optional. Defaults to 5. Configurable via <code>RETRY_INTERVAL</code> environment variable.</p>"},{"location":"enrichers/#retry-exponential-backoff","title":"Retry Exponential Backoff","text":"<p><code>retry_exponential_backoff</code> (<code>bool</code>) controls whether to do exponential backoff. Optional. Defaults to <code>true</code>. Configurable via <code>RETRY_EXPONENTIAL_BACKOFF</code> environment variable.</p>"},{"location":"enrichers/google_public_dns/","title":"Google Public DNS","text":"<ul> <li>https://developers.google.com/speed/public-dns</li> </ul> <p>This enricher uses Google Public DNS to enrich an URL and domain artifact.</p> <pre><code>enricher: google_public_dns\n</code></pre> <p>This enricher can add the following components:</p> <ul> <li>DNS records</li> </ul>","tags":["Enrichment:DNS_Record"]},{"location":"enrichers/google_public_dns/#supported-artifacts","title":"Supported Artifacts","text":"<ul> <li>URL</li> <li>Domain</li> </ul>","tags":["Enrichment:DNS_Record"]},{"location":"enrichers/mmdb/","title":"MMDB","text":"<ul> <li>https://ip.circl.lu/ / adulau/mmdb-server</li> </ul> <p>This enricher uses public MMDB API to enrich an IP artifact.</p> <pre><code>enricher: mmdb\n</code></pre> <p>This enricher can add the following components:</p> <ul> <li>Geolocation</li> <li>Autonomous System</li> </ul>","tags":["Enrichment:Autonomous_System","Enrichment:Geolocation"]},{"location":"enrichers/mmdb/#supported-artifacts","title":"Supported Artifacts","text":"<ul> <li>IP address</li> </ul>","tags":["Enrichment:Autonomous_System","Enrichment:Geolocation"]},{"location":"enrichers/shodan/","title":"Shodan (The InternetDB API)","text":"<ul> <li>https://www.shodan.io/</li> </ul> <p>This enricher uses Shodan InternetDB API to enrich an artifact.</p> <p>https://internetdb.shodan.io/</p> <pre><code>enricher: shodan\n</code></pre> <p>This enricher can add the following components:</p> <ul> <li>Ports</li> <li>CPEs</li> <li>Reverse DNS names</li> <li>Vulnerabilities</li> </ul>","tags":["Enrichment:Port","Enrichment:CPE","Enrichment:Reverse_DNS_Name","Enrichment:Vulnerability"]},{"location":"enrichers/shodan/#supported-artifacts","title":"Supported Artifacts","text":"<ul> <li>IP address</li> </ul>","tags":["Enrichment:Port","Enrichment:CPE","Enrichment:Reverse_DNS_Name","Enrichment:Vulnerability"]},{"location":"enrichers/whois/","title":"Whois","text":"<p>This enricher uses \u201cwhois\u201d command to enrich an artifact.</p> <pre><code>enricher: whois\n</code></pre> <p>This enricher can add the following components:</p> <ul> <li>Whois record</li> </ul>","tags":["Enrichment:Whois_Record"]},{"location":"enrichers/whois/#supported-artifacts","title":"Supported Artifacts","text":"<ul> <li>URL</li> <li>Domain</li> </ul>","tags":["Enrichment:Whois_Record"]},{"location":"tips/alternatives/","title":"Alternatives","text":"<ul> <li>InQuest/ThreatIngestor\u00a0- Extract and aggregate threat intelligence.</li> <li>thalesgroup-cert/Watcher\u00a0- Watcher - Open Source Cybersecurity Threat Hunting Platform. Developed with Django &amp; React JS.</li> <li>projectdiscovery/nuclei - Fast and customizable vulnerability scanner based on simple YAML based DSL.</li> <li>projectdiscovery/uncover - Quickly discover exposed hosts on the internet using multiple search engines.</li> </ul>"},{"location":"tips/docker/","title":"Docker","text":"<p>You can use Mihari with Docker Compose.</p> <pre><code>docker compose up -d\n</code></pre> <p>Mihari's web app is running at <code>localhost:9292</code>.</p> <p>Note</p> <ul> <li>PostgreSQL is used as a database.</li> <li><code>.env</code> file is used for configuring environment variables.</li> </ul>"},{"location":"tips/github_actions/","title":"GitHub Actions","text":"<p>GitHub Actions is a good way to run Mihari searches continuously.</p> <p>The following is an example of a GitHub Actions workflow to run Mihari.</p> <pre><code>name: Mihari searches\n\non:\n  workflow_dispatch:\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Install dependencies\n        run: sudo apt-get -yqq install sqlite3 libsqlite3-dev\n      - name: Set up Ruby 3.2\n        uses: ruby/setup-ruby@v1\n        with:\n          ruby-version: \"3.2\"\n          bundler-cache: true\n      - name: Run Mihari\n        run: |\n          mihari search /path/to/rule.yml\n</code></pre> <p>Tip</p> <p>You need to install <code>libpq-dev</code> for PostgreSQL, <code>libmysqlclient-dev</code> for MySQL.</p> <p>This example assumes that you have <code>Gemfile</code> in your repository.</p> <pre><code>source \"https://rubygems.org\"\n\ngem \"pg\"     # if you use PostgresSQL\ngem \"mysql2\" # if you use MySQL\n\ngem \"mihari\"\n</code></pre>"},{"location":"tips/sentry/","title":"Sentry","text":"<p>You can monitor Mihari with Sentry by setting <code>SENTRY_DSN</code> and <code>SENTRY_TRACE_SAMPLE_RATE</code> environment variables.</p>"},{"location":"tips/sentry/#dsn","title":"DSN","text":"<p>Sentry DSN. Optional. Configurable via <code>SENTRY_DSN</code> environment variable.</p>"},{"location":"tips/sentry/#trace-sample-rate","title":"Trace Sample Rate","text":"<p>Trace sample rate. Defaults to <code>0.25</code>. Configurable via <code>SENTRY_TRACE_SAMPLE_RATE</code> environment variable.</p>"},{"location":"tips/sidekiq/","title":"Sidekiq","text":"<p>You can offload a time-consuming task (e.g, searching by a rule) to Sidekiq in the web app.</p> <p>Mihari executes a search inside the web app by default. In this case, a search may fail due to a request timeout error. Sidekiq can solve this problem.</p> <p>More specifically, the following API endpoints use Sidekiq when Sidekiq is running.</p> <ul> <li><code>POST /api/rules/:id/search</code></li> <li><code>POST /api/artifacts/:id/enrich</code></li> </ul> <p>Note</p> <p>Please make sure that you have a running Redis &amp; <code>SIDEKIQ_REDIS_URL</code> environment variable is set.</p> <pre><code># Start Sidekiq\n$ mihari sidekiq\n# Then the web app is able to use Sidekiq\n$ mihari web\n</code></pre>"},{"location":"tips/superset/","title":"Superset","text":"<p>Apache Superset is an easy-to-use data exploration and data visualization platform.</p> <p>You can install it on your local and also you can use it as a service.</p> <ul> <li>Installing Superset Locally Using Docker Compose</li> <li>Preset Cloud</li> </ul> <p>This doc demonstrates how you can use SuperSet to visualize the Mihari data.</p>"},{"location":"tips/superset/#world-map","title":"World Map","text":"<pre><code>SELECT artifacts.data, artifacts.data_type, geolocations.country_code, artifacts.created_at FROM artifacts\nLEFT OUTER JOIN geolocations ON geolocations.artifact_id  = artifacts.id\nORDER BY artifacts.created_at DESC\n</code></pre> <p>This query generates a result like the following:</p> <p></p> <p>You can visualize the data with the following configuration:</p> <ul> <li>Visualization type: World Map</li> <li>Country column: <code>country_code</code></li> <li>Metric: <code>count(data)</code></li> </ul> <p></p>"}]}